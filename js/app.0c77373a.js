(function(e){function t(t){for(var a,o,s=t[0],l=t[1],c=t[2],u=0,h=[];u<s.length;u++)o=s[u],Object.prototype.hasOwnProperty.call(r,o)&&r[o]&&h.push(r[o][0]),r[o]=0;for(a in l)Object.prototype.hasOwnProperty.call(l,a)&&(e[a]=l[a]);p&&p(t);while(h.length)h.shift()();return i.push.apply(i,c||[]),n()}function n(){for(var e,t=0;t<i.length;t++){for(var n=i[t],a=!0,s=1;s<n.length;s++){var l=n[s];0!==r[l]&&(a=!1)}a&&(i.splice(t--,1),e=o(o.s=n[0]))}return e}var a={},r={app:0},i=[];function o(t){if(a[t])return a[t].exports;var n=a[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=e,o.c=a,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)o.d(n,a,function(t){return e[t]}.bind(null,a));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="/PicInDepth/";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],l=s.push.bind(s);s.push=t,s=s.slice();for(var c=0;c<s.length;c++)t(s[c]);var p=l;i.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},1:function(e,t){},2:function(e,t){},3:function(e,t){},4:function(e,t){},5:function(e,t){},"56d7":function(e,t,n){"use strict";n.r(t);n("e260"),n("e6cf"),n("cca6"),n("a79d");var a=n("2b0e"),r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-app",[n("full-page",{ref:"fullpage"},[n("div",{staticClass:"section"},[e._v(" Introduce "),n("v-btn",{directives:[{name:"show",rawName:"v-show",value:e.isModelReady,expression:"isModelReady"}],attrs:{color:"primary"},on:{click:function(t){return e.$refs.fullpage.api.moveSectionDown()}}},[e._v(" 시작하기 ")])],1),n("div",{staticClass:"section"},[n("v-stepper",{model:{value:e.step,callback:function(t){e.step=t},expression:"step"}},[n("v-stepper-header",[n("v-stepper-step",{attrs:{complete:e.step>1,step:"1"}},[e._v(" 이미지 업로드 ")]),n("v-divider"),n("v-stepper-step",{attrs:{complete:e.step>2,step:"2"}},[e._v(" 편집 ")]),n("v-divider"),n("v-stepper-step",{attrs:{complete:e.step>3,step:"3"}},[e._v(" 완성! ")])],1),n("v-stepper-items",[n("v-stepper-content",{attrs:{step:"1"}},[n("v-overlay",{attrs:{absolute:e.absolute,value:e.overlay}},[n("h2",[e._v("잠시만 기다려주세요")])]),n("v-file-input",{attrs:{rules:e.rules,accept:"image/png, image/jpeg, image/bmp",placeholder:"이미지를 업로드해주세요.","prepend-icon":"mdi-camera",label:"Image"},model:{value:e.baseImage,callback:function(t){e.baseImage=t},expression:"baseImage"}}),n("v-btn",{attrs:{disabled:!e.baseImage,color:"primary"},on:{click:e.base_processing}},[e._v(" test ")])],1),n("v-stepper-content",{attrs:{step:"2"}},[n("div",{staticClass:"workspace"},[n("v-slider",{staticClass:"controller-lineHeight",attrs:{height:"imageHeight",max:"100",min:"0",vertical:""},on:{change:e.draw_line},model:{value:e.lineHeight,callback:function(t){e.lineHeight=t},expression:"lineHeight"}}),n("div",{staticClass:"wrap"},[n("img",{ref:"base"}),n("canvas",{ref:"canv"})]),n("v-slider",{staticClass:"controller-lineHeight",attrs:{height:"imageHeight",max:"100",min:"0",vertical:""},on:{change:e.draw_line},model:{value:e.lineHeight,callback:function(t){e.lineHeight=t},expression:"lineHeight"}})],1),n("div",{staticClass:"controller-wrap"},[n("input",{directives:[{name:"model",rawName:"v-model",value:e.lineColor,expression:"lineColor"}],attrs:{id:"color",type:"color"},domProps:{value:e.lineColor},on:{input:[function(t){t.target.composing||(e.lineColor=t.target.value)},e.draw_line]}}),n("div",{staticClass:"sliders"},[n("v-slider",{attrs:{disabled:e.isMaskGeneratorWorking,hint:"값이 작을수록 선이 위로 와요!","persistent-hint":"",max:"255",min:"0",label:"깊이감"},on:{change:e.generate_depth_mask},model:{value:e.lineDepth,callback:function(t){e.lineDepth=t},expression:"lineDepth"}}),n("v-slider",{attrs:{max:"10",min:"1",label:"두께"},on:{change:e.draw_line},model:{value:e.lineWidth,callback:function(t){e.lineWidth=t},expression:"lineWidth"}})],1)]),n("nav",[n("v-btn",{attrs:{color:"primary"},on:{click:function(t){e.step=1}}},[e._v(" 사진 바꾸기 ")]),n("v-btn",{attrs:{color:"primary"},on:{click:e.generate_photo}},[e._v(" 완성! ")])],1)]),n("v-stepper-content",{attrs:{step:"3"}},[n("div",{staticClass:"showroom"},[n("canvas",{ref:"res"})]),n("nav",[n("v-btn",{attrs:{color:"primary"},on:{click:function(t){e.step=1}}},[e._v(" 사진 바꾸기 ")]),n("v-btn",{attrs:{color:"primary"},on:{click:function(t){e.step=2}}},[e._v(" 편집기로 돌아가기 ")])],1)])],1)],1)],1),n("div",{staticClass:"section"},[e._v("TMI")])])],1)},i=[],o=n("3835"),s=n("1da1"),l=(n("d3b7"),n("fb6a"),n("99af"),n("96cf"),n("ce1a")),c="https://raw.githubusercontent.com/hughesgoon/PicInDepth/main/model/model.json",p={data:function(){return{isModelReady:!1,isMaskGeneratorWorking:!1,model:null,step:1,imageHeight:null,absolute:!0,overlay:!1,lineColor:"#FFFFFF",lineWidth:1,lineHeight:50,lineDepth:128,baseImage:null,baseImage_depthmap:null}},methods:{loadModel:function(){var e=this;return this.isModelReady=!1,l["d"](c).then((function(t){e.model=t,e.isModelReady=!0,console.log("model loaded: ",t)})).catch((function(e){throw console.log("failed to load the model",e),e}))},base_processing:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.overlay=!0,t.next=3,e.Image_to_dataURL(e.baseImage);case 3:n=t.sent,e.setup_workspace(n),e.generate_depthmap(n).then((function(t){e.baseImage_depthmap=t})).then((function(){e.generate_depth_mask()})).then((function(){e.draw_line(),e.overlay=!1,e.step=2}));case 6:case"end":return t.stop()}}),t)})))()},generate_depthmap:function(e){var t=this;return new Promise((function(n){var a=new Image;a.onload=Object(s["a"])(regeneratorRuntime.mark((function e(){var r,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r=t.image_to_tensor(a),e.next=3,t.tensor_to_depthmap(r,[a.width,a.height]);case 3:i=e.sent,n(i);case 5:case"end":return e.stop()}}),e)}))),a.src=e}))},Image_to_dataURL:function(e){return new Promise((function(t){var n=new FileReader;n.onload=function(){t(n.result)},n.readAsDataURL(e)}))},setup_workspace:function(e){var t=this,n=this.$refs.base,a=this.$refs.canv;n.onload=function(){a.width=n.naturalWidth,a.height=n.naturalHeight,t.imageHeight="min(calc((min(100vw, 42.25rem) - 98px) * "+n.naturalHeight+" / "+n.naturalWidth+"), 50vh)",document.getElementsByClassName("controller-lineHeight")[0].getElementsByClassName("v-input__slot")[0].style.height=t.imageHeight,document.getElementsByClassName("controller-lineHeight")[1].getElementsByClassName("v-input__slot")[0].style.height=t.imageHeight},n.src=e},apply_mask_to_line:function(){var e=this;return new Promise((function(t){var n=new Image,a=e.$refs.canv,r=a.getContext("2d");n.onload=function(){r.globalCompositeOperation="destination-in",r.drawImage(n,0,0),t()},n.src=a.style.webkitMaskImage.slice(5,-2)}))},draw_line:function(){var e=this.$refs.canv,t=e.getContext("2d");t.clearRect(0,0,e.width,e.height),t.beginPath(),t.moveTo(0,e.height*(100-this.lineHeight)/100),t.lineTo(e.width,e.height*(100-this.lineHeight)/100),t.lineWidth=e.height*this.lineWidth/100,t.strokeStyle=this.lineColor,t.stroke()},image_to_tensor:function(e){var t=l["a"].fromPixels(e),n=t.toFloat().div(l["h"](255)),a=l["c"].resizeBilinear(n,[224,224],!0);return l["i"](a,[2,0,1]).reshape([1,3,224,224])},tensor_to_depthmap:function(e,t){var n=this;return Object(s["a"])(regeneratorRuntime.mark((function a(){var r,i,s,c,p,u;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return r=Object(o["a"])(t,2),i=r[0],s=r[1],a.next=3,n.model.predict(e);case 3:return c=a.sent,p=l["i"](c,[2,3,1,0]).reshape([224,224,1]),u=l["c"].resizeBilinear(p,[s,i],!0),a.abrupt("return",l["f"](l["b"](u,l["e"](u)),255).asType("int32"));case 7:case"end":return a.stop()}}),a)})))()},generate_depth_mask:function(){var e=this,t=this.$refs.canv,n=document.createElement("canvas"),a=this.baseImage_depthmap,r=a.shape,i=this.lineDepth,o=l["g"]([r[0],r[1],3]);this.isMaskGeneratorWorking=!0,o=0==i?o.concat(l["g"]([r[0],r[1],1]).mul(255),-1).asType("int32"):255==i?o.concat(l["j"]([r[0],r[1],1]),-1).asType("int32"):o.concat(a.floorDiv(i).minimum(1).mul(255),-1).asType("int32"),o.dataSync(),l["a"].toPixels(o,n).then((function(){o.dispose();var a=n.toDataURL();t.style.webkitMaskImage="url("+a+")",e.isMaskGeneratorWorking=!1}))},generate_photo:function(){var e=this,t=this.$refs.base,n=this.$refs.canv,a=Math.min(t.naturalWidth,t.naturalHeight)/10,r=this.$refs.res;r.width=t.naturalWidth+2*a,r.height=t.naturalHeight+5*a;var i=r.getContext("2d");i.fillStyle="#ffffff",i.fillRect(0,0,r.width,r.height),this.apply_mask_to_line().then((function(){i.drawImage(t,a,a),i.drawImage(n,a,a),e.step=3}))}},mounted:function(){this.$refs.fullpage.api.setAllowScrolling(!1),this.$refs.fullpage.api.setKeyboardScrolling(!1),this.loadModel()}},u=p,h=(n("5c0b"),n("2877")),d=n("6544"),m=n.n(d),v=n("7496"),f=n("8336"),g=n("ce7e"),b=n("23a7"),_=n("a797"),w=n("ba0d"),y=n("7e85"),k=n("e516"),x=n("9c54"),C=n("56a4"),I=Object(h["a"])(u,r,i,!1,null,null,null),H=I.exports;m()(I,{VApp:v["a"],VBtn:f["a"],VDivider:g["a"],VFileInput:b["a"],VOverlay:_["a"],VSlider:w["a"],VStepper:y["a"],VStepperContent:k["a"],VStepperHeader:x["a"],VStepperItems:x["b"],VStepperStep:C["a"]});var M=n("a45e"),O=n.n(M),R=n("f309"),S=n("c3af");a["a"].use(R["a"]);var j=new R["a"]({lang:{locales:{ko:S["a"]},current:"ko"}});a["a"].config.productionTip=!1,a["a"].use(O.a),new a["a"]({vuetify:j,render:function(e){return e(H)}}).$mount("#app")},"5c0b":function(e,t,n){"use strict";n("9c0c")},6:function(e,t){},"9c0c":function(e,t,n){}});
//# sourceMappingURL=app.0c77373a.js.map